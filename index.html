<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Expense & Income Tracker</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
      // This configures Tailwind to use the 'dark' class for theme switching
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <script>
        // Set theme on initial load
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
    </script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple animation for list items */
        .transaction-item {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pagination-btn.active {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-5xl">
        
        <header class="text-center mb-8 relative">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Personal Finance Tracker</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-2">Track your income and expenses with ease.</p>
            <button id="theme-toggle" class="absolute top-0 right-0 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 dark:focus:ring-offset-gray-900 focus:ring-blue-500">
                <svg id="theme-toggle-dark-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                <svg id="theme-toggle-light-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.464A1 1 0 106.465 13.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 11a1 1 0 100-2H3a1 1 0 100 2h2zM4.293 4.293A1 1 0 015.707 5.707L5 6.414a1 1 0 11-1.414-1.414l.707-.707z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            </button>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Left Column: Controls & Forms -->
            <div class="space-y-8">
                
                <!-- Balance Summary -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">Your Balance</h2>
                    <div id="current-balance" class="text-4xl font-bold text-blue-600 dark:text-blue-400">$0.00</div>
                </div>
                
                <!-- Set Initial Balance Form -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Set Your Balance</h3>
                    <form id="balance-form">
                        <label for="initial-balance" class="sr-only">Initial Balance</label>
                        <input type="number" id="initial-balance" placeholder="Enter your total balance" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-gray-800 dark:text-gray-200" step="0.01" required>
                        <button type="submit" class="w-full mt-3 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">Set Balance</button>
                    </form>
                </div>

                <!-- Forms Container -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Add Income Form -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                        <h3 class="text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Add New Income</h3>
                        <form id="income-form" class="space-y-4">
                            <div>
                                <label for="income-text" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Description</label>
                                <input type="text" id="income-text" placeholder="e.g., Salary, Freelance" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition text-gray-800 dark:text-gray-200" required>
                            </div>
                            <div>
                                <label for="income-amount" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Amount</label>
                                <input type="number" id="income-amount" placeholder="Enter amount" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition text-gray-800 dark:text-gray-200" step="0.01" required>
                            </div>
                            <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">Add Income</button>
                        </form>
                    </div>

                    <!-- Add Expense Form -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                        <h3 class="text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Add New Expense</h3>
                        <form id="expense-form" class="space-y-4">
                            <div>
                                <label for="expense-text" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Description</label>
                                <input type="text" id="expense-text" placeholder="e.g., Coffee, Groceries" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition text-gray-800 dark:text-gray-200" required>
                            </div>
                            <div>
                                <label for="expense-amount" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Amount</label>
                                <input type="number" id="expense-amount" placeholder="Enter amount" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition text-gray-800 dark:text-gray-200" step="0.01" required>
                            </div>
                            <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">Add Expense</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Column: Summary & History -->
            <div class="space-y-8">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">Summary & History</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg"><h4 class="text-sm font-semibold text-blue-800 dark:text-blue-300">Initial Balance</h4><p id="summary-initial" class="text-2xl font-bold text-blue-900 dark:text-blue-400">$0.00</p></div>
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg"><h4 class="text-sm font-semibold text-green-800 dark:text-green-300">Total Income</h4><p id="summary-income" class="text-2xl font-bold text-green-900 dark:text-green-400">$0.00</p></div>
                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg"><h4 class="text-sm font-semibold text-red-800 dark:text-red-300">Total Expenses</h4><p id="summary-expenses" class="text-2xl font-bold text-red-900 dark:text-red-400">$0.00</p></div>
                    </div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Transaction History</h3>
                    <ul id="transaction-list" class="space-y-3">
                         <li id="no-transactions" class="text-center text-gray-500 dark:text-gray-400 py-4">No transactions yet.</li>
                    </ul>
                    <div id="history-controls" class="mt-4 text-center">
                        <button id="view-all-btn" class="hidden w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">View All Transactions</button>
                        <div id="pagination-controls" class="hidden flex justify-center items-center space-x-2 mt-4"></div>
                    </div>
                </div>
                
                <!-- Data Actions -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md space-y-4">
                    <h3 class="text-lg font-semibold mb-2 text-gray-700 dark:text-gray-300">Export Data</h3>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button id="export-income-csv" class="w-full bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2"><span>Export Income</span></button>
                        <button id="export-expenses-csv" class="w-full bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2"><span>Export Expenses</span></button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        const balanceForm = document.getElementById('balance-form');
        const initialBalanceInput = document.getElementById('initial-balance');
        
        const incomeForm = document.getElementById('income-form');
        const incomeTextInput = document.getElementById('income-text');
        const incomeAmountInput = document.getElementById('income-amount');

        const expenseForm = document.getElementById('expense-form');
        const expenseTextInput = document.getElementById('expense-text');
        const expenseAmountInput = document.getElementById('expense-amount');
        
        const currentBalanceEl = document.getElementById('current-balance');
        const summaryInitialEl = document.getElementById('summary-initial');
        const summaryIncomeEl = document.getElementById('summary-income');
        const summaryExpensesEl = document.getElementById('summary-expenses');
        const transactionListEl = document.getElementById('transaction-list');
        const noTransactionsMessage = document.getElementById('no-transactions');
        
        const exportIncomeCsvBtn = document.getElementById('export-income-csv');
        const exportExpensesCsvBtn = document.getElementById('export-expenses-csv');
        
        const historyControlsEl = document.getElementById('history-controls');
        const viewAllBtn = document.getElementById('view-all-btn');
        const paginationControlsEl = document.getElementById('pagination-controls');
        
        // --- App State ---
        let appState = JSON.parse(localStorage.getItem('financeTrackerState')) || {
            initialBalance: 0,
            incomes: [],
            expenses: [],
            viewingAll: false,
            currentPage: 1,
        };
        const TRANSACTIONS_PER_PAGE = 10;

        // --- Theme Switcher ---
        function updateThemeIcons(isDark) {
            themeToggleDarkIcon.classList.toggle('hidden', isDark);
            themeToggleLightIcon.classList.toggle('hidden', !isDark);
        }
        updateThemeIcons(document.documentElement.classList.contains('dark'));
        
        themeToggleBtn.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            updateThemeIcons(isDark);
        });

        // --- Data Management ---
        function saveState() {
            localStorage.setItem('financeTrackerState', JSON.stringify(appState));
        }

        // --- Core Functions ---
        function updateUI() {
            saveState();
            const { initialBalance, incomes, expenses } = appState;

            const totalIncome = incomes.reduce((acc, item) => acc + item.amount, 0);
            const totalExpenses = expenses.reduce((acc, item) => acc + item.amount, 0);
            const currentBalance = initialBalance + totalIncome - totalExpenses;

            currentBalanceEl.textContent = formatCurrency(currentBalance);
            summaryInitialEl.textContent = formatCurrency(initialBalance);
            summaryIncomeEl.textContent = formatCurrency(totalIncome);
            summaryExpensesEl.textContent = formatCurrency(totalExpenses);
            
            if (currentBalance < 0) {
                currentBalanceEl.classList.remove('text-blue-600', 'dark:text-blue-400');
                currentBalanceEl.classList.add('text-red-600', 'dark:text-red-400');
            } else {
                currentBalanceEl.classList.remove('text-red-600', 'dark:text-red-400');
                currentBalanceEl.classList.add('text-blue-600', 'dark:text-blue-400');
            }

            displayTransactions();
        }

        function displayTransactions() {
            transactionListEl.innerHTML = '';
            const allTransactions = [
                ...appState.incomes.map(i => ({...i, type: 'income'})),
                ...appState.expenses.map(e => ({...e, type: 'expense'}))
            ].sort((a, b) => b.id - a.id);

            if (allTransactions.length === 0) {
                transactionListEl.appendChild(noTransactionsMessage);
                noTransactionsMessage.style.display = 'block';
                historyControlsEl.classList.add('hidden');
                return;
            }
            
            noTransactionsMessage.style.display = 'none';
            historyControlsEl.classList.remove('hidden');

            let transactionsToDisplay;

            if (appState.viewingAll) {
                const startIndex = (appState.currentPage - 1) * TRANSACTIONS_PER_PAGE;
                const endIndex = startIndex + TRANSACTIONS_PER_PAGE;
                transactionsToDisplay = allTransactions.slice(startIndex, endIndex);
                viewAllBtn.classList.add('hidden');
                setupPagination(allTransactions.length);
            } else {
                transactionsToDisplay = allTransactions.slice(0, 3);
                paginationControlsEl.classList.add('hidden');
                if (allTransactions.length > 3) {
                    viewAllBtn.classList.remove('hidden');
                } else {
                    viewAllBtn.classList.add('hidden');
                }
            }

            transactionsToDisplay.forEach(addTransactionToDOM);
        }

        function setupPagination(totalTransactions) {
            const pageCount = Math.ceil(totalTransactions / TRANSACTIONS_PER_PAGE);
            paginationControlsEl.innerHTML = '';

            if (pageCount <= 1) {
                paginationControlsEl.classList.add('hidden');
                return;
            }
            
            paginationControlsEl.classList.remove('hidden');

            for (let i = 1; i <= pageCount; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.classList.add('pagination-btn', 'px-3', 'py-1', 'border', 'dark:border-gray-600', 'rounded-md', 'hover:bg-gray-200', 'dark:hover:bg-gray-700');
                if (i === appState.currentPage) {
                    btn.classList.add('active');
                }
                btn.addEventListener('click', () => {
                    appState.currentPage = i;
                    updateUI();
                });
                paginationControlsEl.appendChild(btn);
            }
        }

        function addTransactionToDOM(transaction) {
            const isIncome = transaction.type === 'income';
            const item = document.createElement('li');
            item.classList.add('transaction-item', 'flex', 'justify-between', 'items-center', 'p-3', 'bg-gray-50', 'dark:bg-gray-700/50', 'rounded-lg', 'border', 'border-gray-200', 'dark:border-gray-700');
            
            const sign = isIncome ? '+' : '-';
            const amountColor = isIncome ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';
            const deleteFunction = isIncome ? `deleteIncome(${transaction.id})` : `deleteExpense(${transaction.id})`;

            item.innerHTML = `
                <span class="font-medium">${transaction.text}</span>
                <div class="flex items-center space-x-4">
                    <span class="font-bold ${amountColor}">${sign}${formatCurrency(Math.abs(transaction.amount))}</span>
                    <button onclick="${deleteFunction}" class="text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                </div>
            `;
            transactionListEl.appendChild(item);
        }
        
        function deleteIncome(id) {
            appState.incomes = appState.incomes.filter(item => item.id !== id);
            updateUI();
        }

        function deleteExpense(id) {
            appState.expenses = appState.expenses.filter(item => item.id !== id);
            updateUI();
        }

        function generateID() {
            return Date.now();
        }

        function formatCurrency(number) {
            return '$' + number.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
        
        function exportToCsv(data, filename) {
            if (data.length === 0) {
                alert(`No ${filename.split('.')[0]} to export.`);
                return;
            }
            const headers = ['ID', 'Date', 'Description', 'Amount'];
            const rows = data.map(tx => [tx.id, new Date(tx.id).toLocaleDateString(), `"${tx.text.replace(/"/g, '""')}"`, tx.amount.toFixed(2)]);
            let csvContent = "data:text/csv;charset=utf-8," + headers.join(",") + "\n" + rows.map(e => e.join(",")).join("\n");
            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- Event Handlers ---
        balanceForm.addEventListener('submit', (e) => { e.preventDefault(); const b = parseFloat(initialBalanceInput.value); if(isNaN(b)) return; appState.initialBalance = b; initialBalanceInput.value = ''; updateUI(); });
        
        incomeForm.addEventListener('submit', (e) => { e.preventDefault(); const t = incomeTextInput.value.trim(); const a = parseFloat(incomeAmountInput.value); if(t===''||isNaN(a)) return; appState.incomes.push({id:generateID(),text:t,amount:Math.abs(a)}); incomeTextInput.value=''; incomeAmountInput.value=''; updateUI(); });
        
        expenseForm.addEventListener('submit', (e) => { e.preventDefault(); const t = expenseTextInput.value.trim(); const a = parseFloat(expenseAmountInput.value); if(t===''||isNaN(a)) return; appState.expenses.push({id:generateID(),text:t,amount:Math.abs(a)}); expenseTextInput.value=''; expenseAmountInput.value=''; updateUI(); });
        
        exportIncomeCsvBtn.addEventListener('click', () => exportToCsv(appState.incomes, 'income.csv'));
        exportExpensesCsvBtn.addEventListener('click', () => exportToCsv(appState.expenses, 'expenses.csv'));
        
        viewAllBtn.addEventListener('click', () => {
            appState.viewingAll = true;
            appState.currentPage = 1;
            updateUI();
        });

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', updateUI);
        
        window.deleteIncome = deleteIncome;
        window.deleteExpense = deleteExpense;

    </script>
</body>
</html>
